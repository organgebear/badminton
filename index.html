<!DOCTYPE html>
<html lang="zh">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta http-equiv="X-UA-Compatible" content="ie=edge">
		<!-- å¼•å…¥css -->
		<link rel="icon" href="./img/badminton.ico" />
		<link rel="stylesheet" type="text/css" href="css/layout.css" />
		<link rel="stylesheet" type="text/css" href="css/base.css" />
		<link rel="stylesheet" type="text/css" href="css/style.css" />
		<link rel="stylesheet" type="text/css" href="css/media.css" />
		<!-- å¼•å…¥js -->
		<script src="js/jquery-3.5.1.min.js" type="text/javascript" charset="utf-8"></script>
		<!-- å¼•å…¥å›¾æ ‡ -->
		<script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
		<script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
		<title>ç¾½æ¯›çƒè®¡åˆ†å™¨</title>
	</head>
	<body>
		<!-- ä¸»è¦å†…å®¹æ¿å— -->
		<div class="counter">
			<div class="counter-title">ğŸ¸ç¾½æ¯›çƒæ¯”èµ›è®¡åˆ†å™¨</div>
			<div class="race-counter">ç¬¬<span class="counter-race">1</span>å±€æ¯”èµ›</div>
			<div class="container">
				<div class="row">
					<div class="col-xl-5 col-md-4 col-sm-12">
						<div class="red card  ">
							<!-- <span class="porint left-point">18</span> -->
							<span class="porint left-point">0</span>
							<div class="button-mark">
								<div class="button-mark-left">
									<ion-icon name="chevron-back-outline" class="icon-left"></ion-icon></div>
								<div class="button-mark-right">
									<ion-icon name="chevron-forward-outline" class="icon-right"></ion-icon></div>
							</div>
						</div>
					</div>
					<div class="col-xl-1 col-md-2 col-sm-6 col-6">
						<div class="red-pro red">
							<span class="porint">0</span>
						</div>
						<div class="porint-reset">é‡ç½®å½“å±€è®°åˆ†ç‰Œ</div>
					</div>
					<div class="col-xl-1 col-md-2 col-sm-6 col-6">
						<div class="blue-pro blue">
							<span class="porint">0</span>
						</div>
						<div class="porint-check">æŸ¥çœ‹æ¯”èµ›è®°å½• <span class="news">0</span></div>
					</div>
					<div class="col-xl-5 col-md-4 col-sm-12">
						<div class="blue card ">
							<!-- <span class="porint right-point">18</span> -->
							<span class="porint right-point">0</span>
							<div class="button-mark">
								<div class="button-mark-left">
									<ion-icon name="chevron-back-outline" class="icon-left"></ion-icon>
								</div>
								<div class="button-mark-right">
									<ion-icon name="chevron-forward-outline" class="icon-right"></ion-icon>
								</div>
							</div>
						</div>

					</div>
				</div>
			</div>
		</div>
		<div class="dialog">
			<div class="title">æ¯”èµ›è®°å½•</div>
			<div class="dialog-content">
				<ul class="race-list">
					<!-- 	<li>
						<div class="race-count">ç¬¬<span class="count">1</span>å±€</div>
						<div class="timer">2022/12/7 12:0:0</div>
						<div class="result">
							<div class="red">21</div>
							<div class="fenge">VS</div>
							<div class="blue">21</div>
						</div>
					</li>
					<li>
						<div class="race-count">ç¬¬<span class="count">1</span>å±€</div>
						<div class="result">
							<div class="red">21</div>
							<div class="fenge">VS</div>
							<div class="blue">21</div>
						</div>
					</li> -->
				</ul>

				<div class="tip">
					<p>æç¤ºè¯­ï¼šåŒæ–¹äº¤æ¢åœºåœ°ä½†æ˜¯ä¸äº¤æ¢çº¢è‰²å’Œè“è‰²æ¿å—</p>
					<p>æç¤ºè¯­ï¼šå•å‡»é»‘è‰²åŒºåŸŸå¼€å§‹ä¸‹ä¸€å±€</p>
				</div>
			</div>
		</div>
		<div class="dialog-mark"></div>
		<div class="getTip-content">
			æˆ‘æ˜¯æç¤ºè¯­
		</div>
		<!-- æé†’å¼€å§‹æ¯”èµ› -->
		<div class="start">
			<div class="start-race"></div>
		</div>
		<!-- æé†’å¼€å§‹æ¯”èµ› end -->
		<!-- ä¸»è¦å†…å®¹æ¿å— end -->
		<script type="text/javascript">
		
			$(".dialog-mark").click(function() {
				$(".dialog ,.dialog-mark").fadeOut()
			})
			$(".porint-check").click(function() {
				$(".dialog ,.dialog-mark").fadeIn()
			})
			$(".button-mark-left").click(function() {
				// console.log(this);
				let grade = $(this).parents('.button-mark').siblings('.porint').text() * 1
				if (grade !== 0) {
					$(this).parents('.button-mark').siblings('.porint').text(grade - 1)
					scaleAnmate($(this).parents('.button-mark').siblings('.porint'))

				}
				// console.log($(this).parents('.button-mark').siblings('.porint'));
			})
			let pointFlag = true
			// console.log(localStorage.getItem('leftPoint'));
			if (localStorage.getItem('leftPoint') !== null) {
				console.log('æœ‰åˆ†æ•°');
				$(".left-point").text(localStorage.getItem('leftPoint'))
				$(".right-point").text(localStorage.getItem('rightPoint'))
			} else {
				// console.log('æ²¡æœ‰åˆ†æ•°');
			}
			// å®šä¹‰äº¤æ¢åœºåœ°å˜é‡
			var reverseFlag = true;
			// å®šä¹‰æ¯”èµ›ç»“æŸå˜é‡
			var raceEndFlag = true;
			// å®šä¹‰æ¯”èµ›å±€æ•°å˜é‡
			var raceCount = 1
			$(".button-mark-right").click(function() {
				let grade = $(this).parents('.button-mark').siblings('.porint').text() * 1
				var leftPoint = $(".left-point").text() * 1
				var rightPoint = $(".right-point").text() * 1
				// å®šä¹‰å½“å‰å±€
				let nowRace = $(".news").text() * 1 + 1
				if (leftPoint !== 30 && rightPoint !== 30) {
					$(this).parents('.button-mark').siblings('.porint').text(grade + 1)
					scaleAnmate($(this).parents('.button-mark').siblings('.porint'))
					// è·å–çº¢è‰²è“è‰²ä¸¤è¾¹çš„åˆ†æ•°
					leftPoint = $(".left-point").text() * 1
					// localStorage.setItem('leftPoint', leftPoint)
					rightPoint = $(".right-point").text() * 1
					// localStorage.setItem('rightPoint', rightPoint)

					if (rightPoint >= 20 && leftPoint >= 20) {
						if (leftPoint - rightPoint == 2) {
							console.log('çº¢è‰²èƒœåˆ©äº†');
							getTip('ç¬¬' + nowRace + 'å±€' + 'çº¢è‰²èƒœåˆ©äº†')
							$(".red-pro").text($(".red-pro").text() * 1 + 1)
							$(".porint").text(0)
							// å¢åŠ æ¯”èµ›è®°å½•
							$(".news").text($(".news").text() * 1 + 1)
							scaleAnmate($(".news"))
							addRace(leftPoint, rightPoint, raceCount)
							raceCount++
							$(".counter-race").text(raceCount)
						}
						if (rightPoint - leftPoint == 2) {
							console.log('è“è‰²èƒœåˆ©äº†');
							getTip('ç¬¬' + nowRace + 'å±€' + 'è“è‰²èƒœåˆ©äº†')
							$(".blue-pro").text($(".blue-pro").text() * 1 + 1)
							$(".porint").text(0)
							// å¢åŠ æ¯”èµ›è®°å½•
							$(".news").text($(".news").text() * 1 + 1)
							scaleAnmate($(".news"))
							addRace(leftPoint, rightPoint, raceCount)
							raceCount++
							$(".counter-race").text(raceCount)
						}
					} else {
						// console.log(hasPoint(leftPoint,rightPoint));
						switch (hasPoint(leftPoint, rightPoint)) {
							case "left":
								console.log('çº¢è‰²èƒœåˆ©äº†');

								getTip('ç¬¬' + nowRace + 'å±€' + 'çº¢è‰²èƒœåˆ©äº†')
								$(".red-pro").text($(".red-pro").text() * 1 + 1)
								$(".porint").text(0)
								// å¢åŠ æ¯”èµ›è®°å½•
								$(".news").text($(".news").text() * 1 + 1)
								scaleAnmate($(".news"))
								addRace(leftPoint, rightPoint, raceCount)
								raceCount++
								$(".counter-race").text(raceCount)
								break;
							case "right":
								console.log('è“è‰²èƒœåˆ©äº†');
								getTip('ç¬¬' + nowRace + 'å±€' + 'è“è‰²èƒœåˆ©äº†')
								$(".blue-pro").text($(".blue-pro").text() * 1 + 1)
								$(".porint").text(0)
								// å¢åŠ æ¯”èµ›è®°å½•
								$(".news").text($(".news").text() * 1 + 1)
								scaleAnmate($(".news"))
								addRace(leftPoint, rightPoint, raceCount)
								raceCount++
								$(".counter-race").text(raceCount)
								break;
						}
					}
				}
				if (leftPoint == 30) {
					getTip('ç¬¬' + nowRace + 'å±€' + 'çº¢è‰²èƒœåˆ©äº†')
					$(".red-pro").text($(".red-pro").text() * 1 + 1)
					$(".porint").text(0)
					// å¢åŠ æ¯”èµ›è®°å½•
					$(".news").text($(".news").text() * 1 + 1)
					scaleAnmate($(".news"))
					addRace(leftPoint, rightPoint, raceCount)
					raceCount++
					$(".counter-race").text(raceCount)
				}
				if (rightPoint == 30) {
					getTip('ç¬¬' + nowRace + 'å±€' + 'è“è‰²èƒœåˆ©äº†')
					$(".blue-pro").text($(".blue-pro").text() * 1 + 1)
					$(".porint").text(0)
					// å¢åŠ æ¯”èµ›è®°å½•
					$(".news").text($(".news").text() * 1 + 1)
					scaleAnmate($(".news"))
					addRace(leftPoint, rightPoint, raceCount)
					raceCount++
					$(".counter-race").text(raceCount)
				}

				// åŒæ–¹1æ¯”1çš„æ—¶å€™æç¤ºäº¤æ¢åœºåœ°
				let red = $(".red-pro ").text() * 1
				let blue = $(".blue-pro ").text() * 1
				if (reverseFlag) {
					if (red == 1 && blue == 1) {
						// console.log('äº¤æ¢åœºåœ°');
						getTip('äº¤æ¢åœºåœ°')
						reverseFlag = false
					}
				}
				if (raceEndFlag) {
					if (red == 2) {
						getTip('çº¢è‰²èƒœåˆ©âœŒ')
						$(".dialog ,.dialog-mark").fadeIn()
						raceCount = 1
						$(".counter-race ").text(raceCount)
						$(".red-pro,.blue-pro").text(0)
					}
					if (blue == 2) {
						getTip('è“è‰²èƒœåˆ©âœŒ')
						$(".dialog ,.dialog-mark").fadeIn()
						raceCount = 1
						$(".counter-race ").text(raceCount)
						$(".red-pro,.blue-pro").text(0)
					}
				}

			})
			// æ·»åŠ æ¯”èµ›è®°å½•å‡½æ•°
			function addRace(red, blue, count) {
				let addTime = new Date
				addTime = addTime.toLocaleDateString() + ' ' + addTime.getHours() + ':' + addTime.getMinutes() + ':' + addTime
					.getSeconds()
				let muban = `<li>
						<div class="race-count">ç¬¬<span class="count">${count}</span>å±€</div>
						<!-- <div class="timer">${addTime}</div> -->
						<div class="result">
							<div class="red">${red}</div>
							<div class="fenge">VS</div>
							<div class="blue">${blue}</div>
						</div>
					</li>`
				$(".race-list").append(muban)
			}
			// æç¤ºæ¡†
			function getTip(text) {
				$(".getTip-content").css('top', '0%')
				$(".getTip-content").text(text)
				setTimeout(function() {
					$(".getTip-content").css('top', '-20%').text(text)
				}, 2000)
			}


			function hasPoint(leftPoint, rightPoint) {
				var winName = ''
				if (leftPoint == 21 && rightPoint !== 20) {
					winName = 'left'
				}
				if (rightPoint == 21 && leftPoint !== 20) {
					winName = 'right'
				}
				return winName
			}

			$(".porint-reset").click(function() {
				scaleAnmate($(this))
				$(".card .porint").text(0)
				getTip('å·²ç»é‡ç½®åˆ†æ•°äº†')
			})
			$(".porint-check").click(function() {
				scaleAnmate($(this))
			})

			function scaleAnmate(obj) {
				if (!obj.hasClass('btn-scale')) {
					obj.addClass('btn-scale')
					setTimeout(function() {
						obj.removeClass('btn-scale')
					}, 500)
				}
			}
		</script>
	</body>
</html>
